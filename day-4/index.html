<!DOCTYPE HTML>
<html lang="pt" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Descomplicando o Prometheus</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/css/style.css">
        <link rel="stylesheet" href="../theme/css/mdbook-admonish.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introdução</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../BOOKSUMMARY.html">Sumário</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Capítulos</li><li class="chapter-item expanded "><a href="../day-1/index.html"><strong aria-hidden="true">1.</strong> Dia 1</a></li><li class="chapter-item expanded "><a href="../day-2/index.html"><strong aria-hidden="true">2.</strong> Dia 2</a></li><li class="chapter-item expanded "><a href="../day-3/index.html"><strong aria-hidden="true">3.</strong> Dia 3</a></li><li class="chapter-item expanded "><a href="../day-4/index.html" class="active"><strong aria-hidden="true">4.</strong> Dia 4</a></li><li class="chapter-item expanded "><a href="../day-5/index.html"><strong aria-hidden="true">5.</strong> Dia 5</a></li><li class="chapter-item expanded "><a href="../day-6/index.html"><strong aria-hidden="true">6.</strong> Dia 6</a></li><li class="chapter-item expanded "><a href="../day-7/index.html"><strong aria-hidden="true">7.</strong> Dia 7</a></li><li class="chapter-item expanded "><a href="../day-8/index.html"><strong aria-hidden="true">8.</strong> Dia 8</a></li><li class="chapter-item expanded "><a href="../day-9/index.html"><strong aria-hidden="true">9.</strong> Dia 9</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Descomplicando o Prometheus</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/badtuxx/DescomplicandoPrometheus" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/badtuxx/DescomplicandoPrometheus/edit/main/pt/src/day-4/README.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <h1 id="descomplicando-o-prometheus"><a class="header" href="#descomplicando-o-prometheus">Descomplicando o Prometheus</a></h1>
<h2 id="day-4"><a class="header" href="#day-4">DAY-4</a></h2>
<h3 id="o-que-iremos-ver-hoje"><a class="header" href="#o-que-iremos-ver-hoje">O que iremos ver hoje?</a></h3>
<p>Uma das coisas mais sensacionais do Prometheus é a quantidade de integrações possíveis. Então hoje vai ser o dia onde nós iremos ver como fazer a integração do Prometheus com o Grafana e o Alertmanager.
Evidente, ainda vamos voltar nessas ferramentas muitas vezes no decorrer do treinamento, mas hoje é o dia de conhecermos como elas funcionam e como podemos integrar com o Prometheus.
 </p>
<h3 id="conteúdo-do-day-4"><a class="header" href="#conteúdo-do-day-4">Conteúdo do Day-4</a></h3>
<details>
<summary class="summary">DAY-4</summary>
<ul>
<li><a href="#descomplicando-o-prometheus">Descomplicando o Prometheus</a>
<ul>
<li><a href="#day-4">DAY-4</a>
<ul>
<li><a href="#o-que-iremos-ver-hoje">O que iremos ver hoje?</a></li>
<li><a href="#conte%C3%BAdo-do-day-4">Conteúdo do Day-4</a></li>
<li><a href="#o-grafana">O Grafana</a>
<ul>
<li><a href="#instalando-o-grafana">Instalando o Grafana</a></li>
<li><a href="#adicionando-o-prometheus-como-data-source">Adicionando o Prometheus como Data Source</a></li>
<li><a href="#criando-o-nosso-primeiro-dashboard">Criando o nosso primeiro Dashboard</a></li>
</ul>
</li>
<li><a href="#alertmanager">Alertmanager</a>
<ul>
<li><a href="#instalando-o-alertmanager">Instalando o Alertmanager</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</details>
<p> </p>
<h3 id="o-grafana"><a class="header" href="#o-grafana">O Grafana</a></h3>
<p>O Grafana é uma ferramenta sensacional demais, impossível alguém não conhecer, e mais impossível ainda alguém não gostar.</p>
<p>Mas o que é esse tal de Grafana?</p>
<p>Te explico agora!</p>
<p>O Grafana é um projeto open source, e é mantido pela empresa Grafana Labs, empresa sueca e que hoje já possuem diferentes produtos, como o Grafana Cloud, Loki, Tempo, etc.</p>
<p>O Grafana é uma poderosa aplicação web que nos permite visualizar, em tempo real e com dashboards incríveis, os dados de diversas fontes, como por exemplo o Prometheus.</p>
<p>Basicamente o Grafana permite que você crie queries super elaboradas para consultar os dados em TSDBs, como o Prometheus, e depois criar dashboards e alertas incríveis.</p>
<p>O Grafa é uma ferramenta que eu uso muito, e que eu recomendo muito, mesmo que você não tenha o Prometheus, o Grafana pode usar dados de diversas fontes, como por exemplo o MySQL, o PostgreSQL, o MongoDB, etc.</p>
<p>Como falei, o Grafana não utiliza somente o Prometheus como fonte, como <code>datasource</code>, ele possui suporte a diferentes fontes de dados, como por exemplo:</p>
<ul>
<li><a href="https://grafana.com/grafana/plugins/grafana-prometheus-datasource">Prometheus</a></li>
<li><a href="https://grafana.com/grafana/plugins/grafana-influxdb-datasource">InfluxDB</a></li>
<li><a href="https://grafana.com/grafana/plugins/grafana-mysql-datasource">MySQL</a></li>
<li><a href="https://grafana.com/grafana/plugins/grafana-postgres-datasource">Postgres</a></li>
<li><a href="https://grafana.com/grafana/plugins/grafana-elasticsearch-datasource">Elasticsearch</a></li>
<li><a href="https://grafana.com/grafana/plugins/grafana-google-cloud-monitoring-datasource">Google Cloud Monitoring</a></li>
<li><a href="https://grafana.com/grafana/plugins/grafana-azure-monitor-datasource">Azure Monitor</a></li>
<li><a href="https://grafana.com/grafana/plugins/grafana-aws-cloudwatch-datasource">AWS CloudWatch</a></li>
<li><a href="https://grafana.com/grafana/plugins/grafana-opentsdb-datasource">OpenTSDB</a></li>
</ul>
<p> </p>
<p>Essas fontes de dados são chamadas de <code>datasources</code>, e o Grafana consegue se conectar a elas e obter os dados que precisamos, e assim ter as métricas que precisamos para montar os nossos dashboards.</p>
<p>O melhor de tudo, o Grafana trata esses <code>datasources</code> como plugins, então você pode criar o seu próprio <code>datasource</code> e utilizar no Grafana, caso ele não tenha suporte a alguma fonte de dados que você precise, ou até mesmo se você quiser criar um <code>datasource</code> para uma fonte de dados que você mesmo criou, sensacional né?</p>
<p> 
 </p>
<h4 id="instalando-o-grafana"><a class="header" href="#instalando-o-grafana">Instalando o Grafana</a></h4>
<p>Vamos começar a nossa jornada na instalação do Grafana, nesse nosso primeiro exemplo vamos realizar a instalação do Grafana como um serviço no Linux, mas seguir a mesma lógica que usamos para instalar o nosso Prometheus.</p>
<p>Ainda vamos ver a instalação e configuração do Prometheus e do Grafana como containers rodando em nosso querido Kubernetes, pode ficar tranquila Pessoa_X!</p>
<p>Bem, vamos lá!</p>
<p>Primeira coisa que temos que fazer é visitar a documentação oficial do Grafana, e lá vamos encontrar a documentação para a sua instalação em diferentes sistemas operacionais, como por exemplo:</p>
<ul>
<li><a href="https://grafana.com/docs/grafana/latest/installation/debian/">Instalação no Linux</a></li>
<li><a href="https://grafana.com/docs/grafana/latest/installation/windows/">Instalação no Windows</a></li>
<li><a href="https://grafana.com/docs/grafana/latest/installation/mac/">Instalação no Mac</a></li>
</ul>
<p>Em nosso exemplo vamos instalar o Grafana no Linux, então vamos seguir a documentação para a instalação no Linux, que você pode acessar <a href="https://grafana.com/docs/grafana/latest/installation/debian/">aqui</a>.</p>
<p> </p>
<p>Para a nossa alegria, o Grafana disponibiliza um repositório para a instalação do Grafana no Linux, como por exemplo no Ubuntu, que estão utilizando desde o começo. :)</p>
<p>Primeira coisa, vamos garantir que alguns pacotes necessários para a instalação do Grafana estejam instalados em nosso sistema, para isso vamos executar o seguinte comando:</p>
<pre><code class="language-bash">sudo apt-get install -y apt-transport-https software-properties-common wget
</code></pre>
<p> </p>
<p>Onde estamos instalando os pacotes</p>
<ul>
<li><code>apt-transport-https</code> - para permitir que o apt use pacotes HTTPS</li>
<li><code>software-properties-common</code> - para permitir que o apt adicione repositórios de terceiros</li>
<li><code>wget</code> - ferramenta utilizada para baixar arquivos da internet</li>
</ul>
<p> </p>
<p>Antes de adicionar o repo do Grafana, precisamos adicionar a chave GPG do repo do Grafana:</p>
<pre><code class="language-bash">wget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -
</code></pre>
<p> </p>
<p>Pronto, agora vamos adicionar o repo do Grafana em nossa máquina, para isso vamos executar o seguinte comando:</p>
<pre><code class="language-bash">sudo add-apt-repository &quot;deb https://packages.grafana.com/oss/deb stable main&quot;
</code></pre>
<p> </p>
<p>Vamos executat o comando <code>apt-get update</code> para atualizar o nosso cache de pacotes e na sequência vamos instalar o Grafana:</p>
<pre><code class="language-bash">sudo apt-get update
sudo apt-get install grafana
</code></pre>
<p> </p>
<p>Se tudo rolou bem, agora o Grafana já está instalado em nossa máquina, vamos iniciar o serviço do Grafana e habilitar o mesmo para iniciar junto com o sistema operacional:</p>
<pre><code class="language-bash">sudo systemctl start grafana-server
sudo systemctl enable grafana-server
</code></pre>
<p> </p>
<p>Para verificar se o Grafana está rodando, execute:</p>
<pre><code class="language-bash">sudo systemctl status grafana-server
</code></pre>
<p> </p>
<p>Se a saída do comando for parecida com essa, então o Grafana está rodando:</p>
<pre><code class="language-bash">● grafana-server.service - Grafana instance
     Loaded: loaded (/lib/systemd/system/grafana-server.service; enabled; vendor preset: enabled)
     Active: active (running) since Wed 2022-09-07 19:34:32 CEST; 6s ago
       Docs: http://docs.grafana.org
   Main PID: 89168 (grafana-server)
      Tasks: 36 (limit: 76911)
     Memory: 43.7M
        CPU: 585ms
     CGroup: /system.slice/grafana-server.service
</code></pre>
<p> </p>
<p>Como falamos, o Grafana é uma aplicação web, sendo assim, precisamos acessar a aplicação através de um navegador, para isso vamos acessar a URL <code>http://localhost:3000</code>:</p>
<p><img src="images/grafana-login.png" alt="Grafana - Login" /></p>
<p> </p>
<p>Muito bem, estamos vendo a tela de login do Grafana, isso significa que temos que ter um usuário para conseguir acessar a aplicação. :D
O usuário padrão do Grafana é <code>admin</code> e a senha padrão é <code>admin</code>, quando não especificamos um usuário inicial durante a instalação do Grafana, então ele cria um usuário padrão e com a senha padrão.</p>
<p>Vamos logar utilizando o usuário <code>admin</code> e a senha <code>admin</code>:</p>
<p><img src="images/grafana-mudar-senha.png" alt="Grafana - Home" /></p>
<p> </p>
<p>Perceba que em seu primeiro login, ele pede para você mudar a senha do usuário <code>admin</code>, então vamos mudar a senha para <code>giropops</code>, no meu caso, no de seu, você que manda. hahaha</p>
<p><img src="images/grafana-home.png" alt="Grafana - Home" /></p>
<p> </p>
<p>Agora sim estamos logados e vendo a tela inicial do Grafana, por enquanto não temos nada de interessante para ver, mas vamos resolver isso em breve. :)</p>
<p> 
 </p>
<h4 id="adicionando-o-prometheus-como-data-source"><a class="header" href="#adicionando-o-prometheus-como-data-source">Adicionando o Prometheus como Data Source</a></h4>
<p>Nos ainda vamos ver mais detalhes do Grafana no Day-4, mas somente para não deixar você com agua na boca, vamos adicionar o Prometheus como Data Source no Grafana, para que possamos começar a criar nossos Dashboards.</p>
<p>Primeira coisa que precisamos fazer é acessar a página de configuração do Data Source, para isso vamos clicar no menu lateral esquerdo em <code>Configuration</code> e depois em <code>Data Sources</code>:</p>
<p><img src="images/grafana-data-sources.png" alt="Grafana - Data Sources" /></p>
<p> </p>
<p><img src="images/grafana-data-source-2.png" alt="Grafana - Add Data Source" /></p>
<p> </p>
<p>Agora vamos clicar no botão <code>Add data source</code> e selecionar o Prometheus:</p>
<p><img src="images/grafana-add-data-source.png" alt="Grafana - Add Data Source" /></p>
<p> </p>
<p><img src="images/grafana-add-data-source-2.png" alt="Grafana - Add Data Source" /></p>
<p> </p>
<p>Agora vamos preencher com as informações do nosso Prometheus, a primeira informação que precisamos preencher é o nome do Data Source, vamos colocar <code>Prometheus</code>.</p>
<p>Depois vamos preencher a URL do Prometheus, que no nosso caso é <code>http://localhost:9090</code>.</p>
<p>Por agora, não vamos adicionar nenhuma informação extra, como por exemplo tipos de autenticação, alertas, etc.</p>
<p>Agora é clicar no botão <code>Save &amp; Test</code> para salvar as configurações e testar a conexão com o Prometheus:</p>
<p><img src="images/grafana-add-data-source-3.png" alt="Grafana - Add Data Source" /></p>
<p> </p>
<p>Se tudo deu certo, vamos ver a seguinte mensagem:</p>
<p><img src="images/grafana-add-data-source-4.png" alt="Grafana - Add Data Source" /></p>
<p> </p>
<p><img src="images/grafana-add-data-source-5.png" alt="Grafana - Add Data Source" /></p>
<p> </p>
<p>Pronto, o Grafana já está configurado para se conectar com o Prometheus, agora vamos criar nosso primeiro Dashboard. :)</p>
<p> 
 </p>
<h4 id="criando-o-nosso-primeiro-dashboard"><a class="header" href="#criando-o-nosso-primeiro-dashboard">Criando o nosso primeiro Dashboard</a></h4>
<p>Muito bem! Chegou o grande momento de criarmos o nosso primeiro Dashboard no Grafana, bem simples ainda, afinal é o nosso primeiro Dashboard.</p>
<p>Primeiro passo, vamos clicar no menu lateral esquerdo em <code>Dashboard</code> e na sequência vamos clicar no botão <code>New Dashboard</code>:</p>
<p><img src="images/grafana-new-dashboard.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Agora vamos escolher o tipo de Dashboard que queremos criar, vamos clicar em <code>Add new panel</code>:</p>
<p><img src="images/grafana-new-dashboard-2.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Pronto, agora já podemos começar a criar o nosso primeiro dashboard. :D</p>
<p><img src="images/grafana-new-dashboard-3.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Pra ficar mais fácil, vamos dividir essa tela em 3 zonas:</p>
<ol>
<li>
<p>A primeira zona é a zona de configuração do painel, onde podemos configurar o título do painel, o tipo de gráfico, etc.</p>
</li>
<li>
<p>A segunda zona é a zona de configuração do <code>Data Source</code>, onde podemos escolher qual <code>Data Source</code> queremos utilizar para alimentar o painel.</p>
</li>
<li>
<p>A terceira zona é a zona de configuração do <code>Query</code>, onde podemos escolher qual métrica queremos visualizar no painel.</p>
</li>
</ol>
<p><img src="images/grafana-new-dashboard-dividido.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Vamos começar pela zona de configuração do painel, vamos clicar no botão <code>Panel Title</code> e vamos mudar o título do painel para <code>CPU Usage</code>:</p>
<p><img src="images/grafana-new-dashboard-4.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Agora vamos definir o data source que queremos utilizar para alimentar o painel, por agora somente temos o do Prometheus, e ele já está selecionado, então vamos deixar assim mesmo.</p>
<p><img src="images/grafana-new-dashboard-5.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Aqui nós temos dois modos de construção de queries, sim, nós iremos construir queries para o Grafana, mas não se preocupe, é bem simples. :D
O primeiro modo, que está se tornando o padrão, é o modo <code>Builder</code>, que facilita a criação de queries, uma vez que é possível selecionar campos, funções, etc, através de menus.</p>
<p>Vamos construir nessa primeira vez a query utilizando o modo <code>Builder</code>, então vamos clicar no botão <code>Builder</code>:</p>
<p><img src="images/grafana-new-dashboard-6.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Agora vamos em <code>Metrics</code> e vamos selecionar a métrica <code>node_cpu_seconds_total</code>:</p>
<p><img src="images/grafana-new-dashboard-7.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Vamos pedir para filtrar pelo label <code>mode</code> e vamos selecionar o valor <code>idle</code>:</p>
<p><img src="images/grafana-new-dashboard-8.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Precisamos ainda utilizar a função <code>rate</code> para calcular a taxa de variação da métrica, então vamos clicar em <code>+ Operations</code>, depois em <code>Range functions</code> e por fim, selecionar a função <code>rate</code>, agora temos aque adicionar o intervalo de tempo que queremos utilizar no campo <code>Range</code>:</p>
<p><img src="images/grafana-new-dashboard-9.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p><img src="images/grafana-new-dashboard-10.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>E finalizando, vamos adicionar uma legenda para o gráfico, vamos clicar em <code>Options</code> e depois em <code>Legend</code> e vamos adicionar a legenda <code>{{cpu}}</code>:</p>
<p><img src="images/grafana-new-dashboard-11.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Agora vamos clicar no botão <code>Run queries</code> para executar a query e vermos o resultado:</p>
<p><img src="images/grafana-new-dashboard-12.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Agora precisamos clicar em <code>Apply</code> para salvar as configurações do painel:</p>
<p><img src="images/grafana-new-dashboard-13.png" alt="Grafana - New Dashboard" /></p>
<p> </p>
<p>Pronto, nosso primeiro dashboard está pronto!
Ainda é bastante simples, mas já deu pra matar a vontade de conhecer o Grafana, né? :D</p>
<p>Ainda vamos voltar para o Grafana durante o dia de hoje para brincar um pouco mais, mas agora vamos colocar o nosso foco no Alertmanager por um momento. :)</p>
<p> 
 </p>
<h3 id="alertmanager"><a class="header" href="#alertmanager">Alertmanager</a></h3>
<p>O Alertmanager é o responsável por gerenciar os alertas que são criados pelo Prometheus, ele é um serviço que recebe os alertas do Prometheus, organiza e os encaminha para os serviços de notificação, como o Slack, e-mail, pagerduty, OpsGenie, etc.</p>
<p>O Alertmanager é um aplicação desenvolvida em Go, e é distribuído como um binário estático, ou seja, não é necessário instalar nenhuma dependência para utilizá-lo. O que vamos precisar fazer, evidemente, é criar um serviço no Systemd para gerencia-lo.</p>
<h4 id="instalando-o-alertmanager"><a class="header" href="#instalando-o-alertmanager">Instalando o Alertmanager</a></h4>
<p>Primeira coisa que precisamos fazer é baixar o binário do Alertmanager, vamos fazer isso através do comando <code>wget</code>. </p>
<p>O endereço do projeto do Alertmanager é o mesmo de onde fizemos o download do Prometheus e do Node Exporter. :D</p>
<p>https://prometheus.io/download/</p>
<p>Vamos baixar a versão mais recente do Alertmanager, no momento em que escrevo esse material, a versão mais recente é a <code>0.24.0</code>, então vamos baixar o binário com o seguinte comando:</p>
<pre><code class="language-bash">wget https://github.com/prometheus/alertmanager/releases/download/v0.24.0/alertmanager-0.24.0.linux-amd64.tar.gz
</code></pre>
<p> </p>
<p>Agora vamos descompactar o arquivo que baixamos, vamos utilizar o comando <code>tar</code> para isso:</p>
<pre><code class="language-bash">tar -xvzf alertmanager-0.24.0.linux-amd64.tar.gz
</code></pre>
<p> </p>
<p>Agora nós temos um diretório chamado <code>alertmanager-0.24.0.linux-amd64</code>, vamos entrar nesse diretório e copiar o binário do Alertmanager para o diretório <code>/usr/local/bin</code>:</p>
<pre><code class="language-bash">cd alertmanager-0.24.0.linux-amd64
cp alertmanager /usr/local/bin
</code></pre>
<p> </p>
<p>Agora vamos criar o diretório <code>/etc/alertmanager</code> e copiar o arquivo de configuração do Alertmanager para esse diretório:</p>
<pre><code class="language-bash">mkdir /etc/alertmanager
cp alertmanager.yml /etc/alertmanager
</code></pre>
<p> </p>
<p>Vamos dar uma olhada no arquivo de configuração do Alertmanager:</p>
<pre><code class="language-bash">cat /etc/alertmanager/alertmanager.yml
</code></pre>
<p> </p>
<pre><code class="language-yaml">route:
  group_by: ['alertname']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 1h
  receiver: 'web.hook'
receivers:
  - name: 'web.hook'
    webhook_configs:
      - url: 'http://127.0.0.1:5001/'
inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'dev', 'instance']
</code></pre>
<p> </p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../day-3/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../day-5/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../day-3/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../day-5/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>